<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/Entity.js | Savannah documentation API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  <a href="./manual/index.html" data-ice="manualHeaderLink">Manual</a>
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Client.js~Client.html">Client</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ClientHandle.js~ClientHandle.html">ClientHandle</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Component.js~Component.html">Component</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Entity.js~Entity.html">Entity</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Game.js~Game.html">Game</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/GameModel.js~GameModel.html">GameModel</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/History.js~History.html">History</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/NetCodec.js~NetCodec.html">NetCodec</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/RPC.js~RPC.html">RPC</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Scene.js~Scene.html">Scene</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Server.js~Server.html">Server</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/System.js~System.html">System</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/Timer.js~Timer.html">Timer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-uid">uid</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-game">game</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Keycodes">Keycodes</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Keynames">Keynames</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-aliases">aliases</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-Log">Log</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-rPC">rPC</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">components</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Camera.js~Camera.html">Camera</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/CircleShape.js~CircleShape.html">CircleShape</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Input.js~Input.html">Input</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Physics.js~Physics.html">Physics</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/RawSprite.js~RawSprite.html">RawSprite</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/RectangleShape.js~RectangleShape.html">RectangleShape</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Shape.js~Shape.html">Shape</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Sprite.js~Sprite.html">Sprite</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/components/Transform.js~Transform.html">Transform</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">drivers</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/drivers/Graphics.js~Graphics.html">Graphics</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-graphics">graphics</a></span></span></li>
<li data-ice="doc"><div data-ice="dirPath" class="nav-dir-path">systems</div><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/systems/GraphicSystem.js~GraphicSystem.html">GraphicSystem</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/systems/PhysicSystem.js~PhysicSystem.html">PhysicSystem</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/Entity.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import { uid } from &apos;./utils.js&apos;;
import { Log } from &apos;./Log.js&apos;;
import Physics from &apos;./components/Physics.js&apos;;

export default class Entity {

  constructor(scene, id = null) {
    this._components = {};
    this._scene = scene;
    this._parent = null;
    this._parentId = null;
    this._id = (id !== null) ? id : uid();
    this._compIdCounter = 0;
    this._isSynchronized = true;
    this._transform = null;
    this._handlers = {};
    this._destroyed = false;
  }

  get parent() {
    if (this._parent == null) {
      this._parent = this.scene.model.getEntity(this._parentId);
    }
    return this._parent;
  }

  set parent(arg) {
    if (typeof arg === &apos;string&apos;) {
      this._parent = null;
      this._parentId = arg;
    } else if (arg !== null &amp;&amp; typeof arg === &apos;object&apos;) {
      var entity = arg.entity || entity; // Links to entity even if component is passed
      this._parent = arg;
      this._parentId = arg.id;
    } else {
      this._parent = null;
      this._parentId = null;
    }
  }

  get id() {
    return this._id;
  }

  get components() {
    return this._components;
  }

  get isSynchronized() {
    return this._isSynchronized;
  }

  get scene() {
    return this._scene;
  }

  get transform() {
    return this._transform;
  }

  get physics() {
    return this.getComponent(Physics);
  }

  get destroyed() {
    return this._destroyed;
  }

  enableNetworking() {
    this._isSynchronized = true;
  }

  disableNetworking() {
    this._isSynchronized = false;
  }

  triggerEvent(evt, data) {
    if (this._handlers[evt] != null) {
      for (const h of this._handlers[evt]) {
        h(data);
      }
    }
  }

  addComponent(Comp, id = null) {
    var comp_id = (id == null) ? uid() : id;
    var comp = new Comp(this, comp_id);
    this._components[comp_id] = comp;
    this._registerComponentHandlers(comp);

    // Special case optimization for extremely common components
    if (Comp.name === &apos;Transform&apos;) {
      this._transform = comp;
    }
    return comp;
  }

  _registerComponentHandlers(comp) {
    for (const evt of Object.keys(comp.eventHandlers)) {
      this._addEventHandler(evt, comp.eventHandlers[evt]);
    }
  }

  _addEventHandler(evt, fn) {
    if (typeof this._handlers[evt] === &apos;undefined&apos;) {
      this._handlers[evt] = [];
    }
    this._handlers[evt].push(fn);
  }

  addComponents(Comps) {
    for (let Comp of Comps) {
      this.addComponent(Comp);
    }
  }
  
  removeComponent(id) {
    throw new Error(&apos;Removing components is not supported&apos;);
    // Cannot remove component for now because we would need to remove associated event handlers

    // const comp = this._components[id];
    // if (comp === this._transform) {
    //   this._transform = null;
    // }
    // delete this._components[id];
  }

  destroy() {
    this._destroyed = true;
  }

  getComponent(Type) {
    for (const i of Object.keys(this._components)) {
      const comp = this._components[i];
      if (comp.constructor.name === Type.name) {
        return comp;
      }
    }
  }

  onCreate() {
    for (let i of Object.keys(this._components)) {
      const component = this._components[i];
      this._components[i].onCreate();
    }
  }

  onDestroy() {
    for (let i of Object.keys(this._components)) {
      const component = this._components[i];
      this._components[i].onDestroy();
    }
  }


  onUpdate(dt) {
    for (let i of Object.keys(this._components)) {
      const component = this._components[i];
      if (component.enabled) {
        this._components[i].onUpdate(dt);
      }
    }
  }
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.6)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
